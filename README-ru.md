# GitLab MCP Server

GitLab MCP — сервер Model Context Protocol, который предоставляет инструменты для работы с проектами GitLab, merge-request'ами и тегами непосредственно из Claude Code, Code CLI и других MCP-клиентов.

## Содержание

- [Возможности](#возможности)
- [Требования](#требования)
- [Установка](#установка)
- [Запуск сервера (stdio)](#запуск-сервера-stdio)
- [Конфигурация для Code (Рекомендуется)](#конфигурация-для-code-рекомендуется)
- [Конфигурация для Claude Code CLI](#конфигурация-для-claude-code-cli)
- [MCP-инструменты](#mcp-инструменты)

## Возможности

- Получение списка доступных проектов GitLab и подробной информации по каждому проекту.
- Просмотр тегов репозитория с расчётом следующего релизного тега по SemVer.
- Списки merge-request'ов с фильтрами по состоянию и дате обновления.
- Детальная информация о merge-request'ах с флагом «свежести» (смерджено менее 24 часов назад).
- Поиск по merge-request'ам (название и описание).
- Список пользователей GitLab с отслеживанием активности и batch-операциями.
- Управление участниками проектов и групп с информацией об уровнях доступа.

## Требования

- Node.js ≥ 20
- Переменные окружения:
  - `GITLAB_URL` — базовый URL инстанса GitLab
  - `GITLAB_TOKEN` — персональный токен доступа с правами `read_api` и `read_repository`

## Установка

### Используя npx (Рекомендуется)

Вы можете запустить сервер напрямую через npx без установки:

```bash
GITLAB_URL="https://gitlab.example.com" \
GITLAB_TOKEN="glpat-your-token-here" \
npx -y @vitalyostanin/gitlab-mcp
```

### Используя Claude MCP CLI

Установка через Claude MCP CLI:

```bash
claude mcp add --scope user gitlab-mcp npx -y @vitalyostanin/gitlab-mcp
```

После выполнения команды вас попросят ввести URL GitLab и токен.

**Опции области видимости:**
- `--scope user`: Установка для текущего пользователя (для всех проектов)
- `--scope project`: Установка только для текущего проекта

**Удаление:**

```bash
claude mcp remove gitlab-mcp --scope user
```

### Ручная установка (Для разработки)

```bash
npm install
npm run build
```

## Запуск сервера (stdio)

```bash
GITLAB_URL="https://gitlab.example.com" \
GITLAB_TOKEN="glpat-example-token" \
node dist/index.js
```

## Конфигурация для Code (Рекомендуется)

Чтобы использовать этот MCP сервер с [Code](https://github.com/just-every/code), добавьте следующую конфигурацию в `~/.code/config.toml`:

```toml
[mcp_servers.gitlab-mcp]
command = "npx"
args = ["-y", "@vitalyostanin/gitlab-mcp"]
env = { "GITLAB_URL" = "https://gitlab.example.com", "GITLAB_TOKEN" = "glpat-your-token-here" }
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Альтернативно, для локальной разработки используйте `command = "node"` с `args = ["/path/to/dist/index.js"]`.

## Конфигурация для Claude Code CLI

Чтобы использовать этот MCP сервер с [Claude Code CLI](https://github.com/anthropics/claude-code), вы можете:

1. **Использовать Claude MCP CLI** - смотрите секцию [Установка](#установка) выше
2. **Ручная конфигурация** - добавьте в файл `~/.claude.json`:

```json
{
  "mcpServers": {
    "gitlab-mcp": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@vitalyostanin/gitlab-mcp"],
      "env": {
        "GITLAB_URL": "https://gitlab.example.com",
        "GITLAB_TOKEN": "glpat-your-token-here"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Для локальной разработки используйте `"command": "node"` с `"args": ["/абсолютный/путь/к/gitlab-mcp/dist/index.js"]`.

## MCP-инструменты

| Инструмент | Описание |
| --- | --- |
| `service_info` | Статус подключения к GitLab и активные фильтры. |
| `gitlab_projects` | Список доступных проектов с пагинацией и поиском. |
| `gitlab_project_details` | Подробности проекта по ID или namespace. |
| `gitlab_project_tags` | Теги проекта + подсказка следующего релизного тега. |
| `gitlab_projects_search` | Поиск проектов по имени, пути и описанию. |
| `gitlab_merge_requests` | Merge-request'ы проекта с фильтрами и пагинацией. |
| `gitlab_merge_request_details` | Детали MR, включая ссылки и флаг свежести. |
| `gitlab_merge_requests_search` | Поиск merge-request'ов по названию и описанию. |
| `gitlab_users` | Список пользователей с пагинацией и отслеживанием активности. |
| `gitlab_user_details` | Подробная информация о пользователе по ID или username. |
| `gitlab_users_batch` | Эффективное получение информации о нескольких пользователях (макс. 50). |
| `gitlab_current_user` | Информация о текущем пользователе (владелец токена). |
| `gitlab_project_members` | Список участников проекта с уровнями доступа. |
| `gitlab_group_members` | Список участников группы с уровнями доступа. |

### Руководство по использованию инструментов

#### Инструменты для работы с проектами

- **`gitlab_projects`**: Получение списка доступных проектов с опциональными фильтрами (membership, базовый поиск). Использует endpoint `/api/v4/projects`. **Применение**: Просмотр доступных проектов, список проектов где вы являетесь участником.

- **`gitlab_projects_search`**: Поиск конкретных проектов по ключевым словам через GitLab Search API. Использует endpoint `/api/v4/search?scope=projects`. **Применение**: Поиск конкретных проектов по имени или пути (например, "telegram/service").

**Ключевое различие**: `gitlab_projects` предназначен для листинга/просмотра с фильтрами, в то время как `gitlab_projects_search` обеспечивает целевой поиск по ключевым словам через Search API.

#### Инструменты для работы с merge requests

- **`gitlab_merge_requests`**: Получение списка merge requests для конкретного проекта с фильтрами (состояние, диапазон дат). Требует указания идентификатора проекта. **Применение**: Получение всех MR для конкретного проекта, фильтрация по состоянию или дате обновления.

- **`gitlab_merge_requests_search`**: Поиск merge requests по тексту (заголовок, описание) через GitLab Search API. Может искать по всем проектам или в рамках конкретного проекта. **Применение**: Поиск MR по ключевым словам среди всех проектов.

**Ключевое различие**: `gitlab_merge_requests` выводит список MR для конкретного проекта, в то время как `gitlab_merge_requests_search` находит MR по текстовому поиску среди всех проектов.

##### Флаг свежести

**Флаг свежести** (freshness flag) — это булево поле, возвращаемое инструментом `gitlab_merge_request_details`, которое указывает, является ли merge request "свежим" или недавно смерженным:

- **Для несмерженных MR** (состояние `opened` или `closed`): `fresh = true` (всегда считаются свежими)
- **Для смерженных MR**:
  - `fresh = true` — смерджено в течение последних **24 часов**
  - `fresh = false` — смерджено более 24 часов назад

**Примеры использования:**
- Выявление недавно смерженных изменений, которые могут требовать внимания
- Отслеживание горячей/недавней активности merge requests в проекте
- Фильтрация старых смерженных MR при просмотре недавних изменений

**Пример ответа:**
```json
{
  "mergeRequest": {
    "id": 123,
    "iid": 45,
    "title": "Добавить новую функцию",
    "state": "merged",
    "mergedAt": "2025-10-13T10:30:00Z",
    "fresh": true
  }
}
```

#### Инструменты для работы с пользователями

- **`gitlab_users`**: Список всех пользователей GitLab с опциональными фильтрами (активные, заблокированные, поиск). Возвращает базовую информацию о пользователях, включая дату последней активности. **Применение**: Просмотр доступных пользователей, поиск пользователей по имени или username, мониторинг активности пользователей.

- **`gitlab_user_details`**: Получение подробной информации о конкретном пользователе по ID или username. Включает даты последней активности и входа. **Применение**: Получение деталей профиля пользователя, проверка статуса пользователя, просмотр истории активности.

- **`gitlab_users_batch`**: Получение подробной информации о нескольких пользователях одновременно (batch-режим, макс. 50 пользователей). Оптимизировано для массовых операций с параллельными API-запросами. Возвращает массив пользователей и массив notFound для отсутствующих пользователей. **Применение**: Эффективное получение информации о нескольких пользователях, анализ активности команды, массовое получение информации о пользователях.

- **`gitlab_current_user`**: Получение информации о текущем пользователе (владелец API токена). Включает флаги разрешений и статус 2FA. **Применение**: Проверка аутентификации, проверка разрешений текущего пользователя.

- **`gitlab_project_members`**: Список участников конкретного проекта с их уровнями доступа (Guest=10, Reporter=20, Developer=30, Maintainer=40, Owner=50). **Применение**: Проверка того, кто имеет доступ к проекту, просмотр уровней доступа, поиск мейнтейнеров проекта.

- **`gitlab_group_members`**: Список участников группы/namespace с их уровнями доступа (Guest=10, Reporter=20, Developer=30, Maintainer=40, Owner=50). **Применение**: Проверка членства в группе, просмотр уровней доступа группы, поиск администраторов группы.

**Ключевые возможности**:
- Все инструменты для работы с пользователями включают поля `lastActivityOn` и `lastSignInAt` для отслеживания активности
- Batch-режим поддерживает до 50 пользователей за один запрос для оптимальной производительности
- Корректно обрабатывает отсутствующих пользователей без сбоя всего batch-запроса
- Уровни доступа предоставляются как в числовом виде, так и в виде понятных описаний
